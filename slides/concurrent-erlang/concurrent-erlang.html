<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="author" content="Erlang Solutions Ltd."><title>Concurrent Erlang</title><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui" name="viewport"><link href="reveal.js/css/reveal.min.css" rel="stylesheet"><link rel="stylesheet" href="reveal.js/css/theme/default.css" id="theme"><link href="reveal.js/lib/css/zenburn.css" rel="stylesheet"><script type="text/javascript">document.write( '<link rel="stylesheet" href="reveal.js/css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );</script></head><body><div class="reveal"><div class="slides"><section><h1>Concurrent Erlang</h1><p>Erlang Solutions Ltd.</p></section><div id="preamble"><div class="sectionbody"><link rel="stylesheet" type="text/css" href="../../styles/svg.css"></link>
<script type="text/javascript" src="../../tools/snap.svg/snap.svg-min.js"></script></div></div>
<section id="_overview_strong_concurrent_erlang_i_strong"><h2>Overview: <strong>concurrent Erlang I</strong></h2><div class="ulist"><ul><li><p>Concurrent Erlang I</p><div class="ulist"><ul><li><p>Creating Processes</p></li><li><p>Message Passing</p></li><li><p>Receiving Messages</p></li><li><p>Data in Messages</p></li></ul></div></li><li><p>Concurrent Erlang II</p></li></ul></div></section>
<section id="_creating_processes"><h2>Creating Processes</h2><svg id="creating_processes_1" style="height:600px; width:600px;" class="left">
<script>

var s1 = Snap("#creating_processes_1");

var arrow = s1.polygon([0,0, 5,2.5, 0,5]).attr({"fill":"#000"}).transform('r0');
var marker = arrow.marker(0,0, 5,5, 4,2.75);

s1.text(40,40,"Pid2 = spawn(Mod, Func, Args)").addClass("code");
s1.text(220,180,"Pid1").addClass("code");

s1.circle(250,100,40).addClass("shape grey");

var s1_line1 = s1.path("M210,100 A90,90 0 1,0 205,450").attr({"stroke-dasharray":"5,5", "marker-end":marker}).addClass("line dashed");

var s1_shape1_1 = s1.text(120,390,"Mod:Func(Arg1, ...)").addClass("code");
var s1_shape1_2 = s1.text(220,530,"Pid2").addClass("code");
var s1_shape1_3 = s1.circle(250,450,40).addClass("shape darkred");

var s1_shape1 = s1.g(s1_shape1_1, s1_shape1_2, s1_shape1_3);

s1_line1.addClass("hide");
s1_shape1.addClass("hide");

s1_anim1 = function() { s1_shape1.animate({"opacity":"1"}, 250, mina.linear, s1_anim2); }
s1_anim2 = function() { s1_line1.animate({"opacity":"1"}, 500, mina.linear); }
s1.click(function() { s1_anim1() });

</script>
</svg>
<div class="ulist right"><ul><li><p>Before</p><div class="ulist"><ul><li><p>Code executed by Process 1</p></li><li><p><strong>process identifier</strong> is Pid1</p></li><li><p>Pid2 = spawn(M, F, A)</p></li></ul></div></li><li><p>After</p><div class="ulist"><ul><li><p>A new process with Pid2 is created</p></li><li><p>Pid2 is only known to Pid1</p></li><li><p>Pid2 runs M:F(A)</p></li><li><p>M:F/Arity must be exported</p></li></ul></div></li><li><p>Convention: we identify processes by their process ids (pids)</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>spawn(timer, sleep, [10000]).</p></div></aside></section>
<section id="_creating_processes_2"><h2>Creating Processes</h2><svg id="creating_processes_2" style="height:600px; width:600px;" class="left">
<script>

var s2 = Snap("#creating_processes_2");

var arrow = s2.polygon([0,0, 5,2.5, 0,5]).attr({"fill":"#000"}).transform('r0');
var marker = arrow.marker(0,0, 5,5, 4,2.75);

s2.text(40,40,"Pid2 = spawn(Mod, Func, Args)").addClass("code");
s2.text(220,180,"Pid1").addClass("code");

s2.circle(250,100,40).addClass("shape grey");

var s2_line1_1 = s2.path("M210,100 A90,90 0 1,0 205,450").attr({"stroke-dasharray":"5,5", "marker-end":marker}).addClass("line dashed");
var s2_line1_2 = s2.text(50,295,"spawns").addClass("code");

var s2_shape1_1 = s2.text(220,530,"Pid2").addClass("code");
var s2_shape1_2 = s2.circle(250,450,40).addClass("shape darkred");

//Groups
var s2_line1 = s2.g(s2_line1_1, s2_line1_2);
var s2_shape1 = s2.g(s2_shape1_1, s2_shape1_2);

s2_line1.addClass("hide");
s2_shape1.addClass("hide");

s2_anim1 = function() { s2_line1.animate({"opacity":"1"}, 250, mina.linear, s2_anim2); }
s2_anim2 = function() { s2_shape1.animate({"opacity":"1"}, 175, mina.linear); }
s2.click(function() { s2_anim1() });

</script>
</svg>
<div class="ulist right"><ul><li><p>The BIF <strong>spawn</strong> never fails</p></li><li><p>A process terminates</p><div class="ulist"><ul><li><p><strong>abnormally</strong> when run-time errors occur</p></li><li><p><strong>normally</strong> when there is no more code to execute</p></li></ul></div></li></ul></div>
<aside class="notes"><div class="paragraph"><p>spawn <strong>can</strong> actually fail (if you run out of processes). The R15 limit is 32768; R16 limit is 262144. You can set it via the +P flag and retrieve it via erlang:system_info(process_limit).</p></div></aside></section>
<section id="_message_passing"><h2>Message Passing</h2><svg id="message_passing_1" style="height:600px; width:600px;" class="left">
<script>

var s3 = Snap("#message_passing_1");

var arrow = s3.polygon([0,0, 5,2.5, 0,5]).attr({"fill":"#000"}).transform('r0');
var marker = arrow.marker(0,0, 5,5, 4,2.75);


s3.text(67,150,"Pid1").addClass("code");
s3.circle(100,200,40).addClass("shape grey");

s3.text(367,150,"Pid2").addClass("code");
s3.circle(400,200,40).addClass("shape darkred");

s3.text(5,290,"Pid1").addClass("code darkred bold");
s3.text(90,290,"! {self(),foo}").addClass("code");

var s3_line1_1 = s3.path("M140,200 l215,0").attr({"marker-end":marker}).addClass("line");
var s3_line1_2 = s3.text(153,188,"{Pid1,foo}").addClass("code");

//Groups
var s3_line1 = s3.g(s3_line1_1, s3_line1_2);

s3_line1.addClass("hide");

s3.click( function() { s3_line1.animate({"opacity":"1"}, 300, mina.linear); } );

</script>
</svg>
<div class="ulist right"><ul><li><p>Messages are sent using the <strong>Pid ! Msg</strong> expression</p><div class="ulist"><ul><li><p><strong>Msg</strong> is any valid Erlang data type</p></li></ul></div></li><li><p>Sending a message will never fail</p></li><li><p>Messages sent to non-existing processes are thrown away</p></li><li><p>Received messages are stored in the process' mailbox</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Ask the students what they think the BIF self() returns.<br>
Have the students send messages to themselves in the shell: self() ! hello.<br>
Remind them that they can not type pids in the shell. They need to use pid/3.<br>
Introduce the shell function flush().<br>
Make them crash the shell using 1/0 before flushing.<br>
Let them try out the command shell command i().</p></div></aside></section>
<section id="_message_passing_2"><h2>Message Passing</h2><svg id="message_passing_2" style="height:600px; width:800px;" class="left">
<script>

var s4 = Snap("#message_passing_2");

var arrow = s4.polygon([0,0, 4,2, 0,4]).attr({"fill":"#000"}).transform('r0').addClass("darkred");
var marker = arrow.marker(0,0, 4,4, 3,2);

s4.text(200,160,"receive").addClass("code bold font18pt");
s4.text(200,200,"    {reset, Board} -> reset(Board);").addClass("code font18pt");
s4.text(200,240,"    {do, Signal} -> process(Signal)").addClass("code font18pt");
s4.text(200,280,"end").addClass("code bold font18pt");

var s4_clauses_1 = s4.text(10,220,"clauses").addClass("darkred font19pt");
var s4_clauses_2 = s4.path("M110,214 l135,-22").attr({"marker-end":marker}).addClass("line_darkred");
var s4_clauses_3 = s4.path("M110,214 l135,18").attr({"marker-end":marker}).addClass("line_darkred");
var s4_clauses_4 = s4.polyline("255,170 465,170 465,210 435,210 435,250 255,250 255,170").attr({"stroke-dasharray":"5,5"}).addClass("line_darkred");
var s4_clauses = s4.g(s4_clauses_1, s4_clauses_2, s4_clauses_3, s4_clauses_4)

var s4_clause_separator_1 = s4.text(550,70,"clause separator").addClass("darkred font19pt")
var s4_clause_separator_2 = s4.path("M655,82 l40,93").attr({"marker-end":marker}).addClass("line_darkred");
var s4_clause_separator_3 = s4.circle(698,194,13).addClass("circle_darkred");
var s4_clause_separator = s4.g(s4_clause_separator_1, s4_clause_separator_2, s4_clause_separator_3);

var s4_last_clause_1 = s4.text(635,340,"no separator").addClass("darkred font19pt");
var s4_last_clause_2 = s4.text(635,372,"in last clause").addClass("darkred font19pt");
var s4_last_clause_3 = s4.path("M712,318 l0,-68").attr({"marker-end":marker}).addClass("line_darkred");
var s4_last_clause_4 = s4.circle(712,231,13).addClass("circle_darkred");
var s4_last_clause = s4.g(s4_last_clause_1, s4_last_clause_2, s4_last_clause_3, s4_last_clause_4);

var s4_patterns_1 = s4.text(250,370,"patterns").addClass("darkred font19pt");
var s4_patterns_2 = s4.path("M300,345 l35,-85").attr({"marker-end":marker}).addClass("line_darkred");
var s4_patterns = s4.g(s4_patterns_1, s4_patterns_2);

var s4_clause_body_1 = s4.text(460,330,"clause body").addClass("darkred font19pt");
var s4_clause_body_2 = s4.path("M535,305 l45,-50").attr({"marker-end":marker}).addClass("line_darkred");
var s4_clause_body_3 = s4.polyline("483,213 705,213 705,250 483,250 483,213").attr({"stroke-dasharray":"5,5"}).addClass("line_darkred");
var s4_clause_body = s4.g(s4_clause_body_1, s4_clause_body_2, s4_clause_body_3);

s4_clauses.addClass("hide");
s4_clause_separator.addClass("hide");
s4_last_clause.addClass("hide");
s4_patterns.addClass("hide");
s4_clause_body.addClass("hide");

var s4_counter=1
s4.click( function() {
  switch(s4_counter) {
    case 1: {s4_clauses.animate({"opacity":"1"}, 250, mina.linear); s4_counter++; break};
    case 2: {s4_clause_separator.animate({"opacity":"1"}, 250, mina.linear); s4_counter++; break};
    case 3: {s4_last_clause.animate({"opacity":"1"}, 250, mina.linear); s4_counter++; break};
    case 4: {s4_patterns.animate({"opacity":"1"}, 250, mina.linear); s4_counter++; break};
    case 5: {s4_clause_body.animate({"opacity":"1"}, 250, mina.linear); s4_counter++; break};
    }
} );

</script>
</svg>
<aside class="notes"><div class="ulist"><ul><li><p>Shared memory with lock</p></li><li><p>STM (software transactional memory)</p></li><li><p>Promises</p></li><li><p>Message Passing</p></li></ul></div></aside></section>
<section id="_receiving_messages"><h2>Receiving Messages</h2><div class="left">
<div class="pre"><span class="redcode">receive</span>
    Pattern1 -&gt;
         &lt;expression 1&gt;,
         &lt;expression 2&gt;,
         ...,
         &lt;expression N&gt;;
    Pattern2 -&gt;
         &lt;expression 1&gt;,
         ...,
         &lt;expression N&gt;;
    ...;
    PatternN -&gt;
         &lt;expression 1&gt;,
         ...
         &lt;expression N&gt;
<span class="redcode">end</span>
</div></div>
<div class="ulist right"><ul><li><p>Messages are retrieved using a <strong>receive</strong> clause</p></li><li><p><strong>receive</strong> suspends the process until a matching message is received</p></li><li><p>Message passing is asynchronous</p></li></ul></div></section>
<section id="_receiving_messages_2"><h2>Receiving Messages</h2><svg id="receiving_messages_2" style="height:650px; width:650px;" class="left">
<script>

var s5 = Snap("#receiving_messages_2");

var arrow = s5.polygon([0,0, 4,2, 0,4]).attr({"fill":"#000"}).transform('r0');
var marker = arrow.marker(0,0, 4,4, 3,2);

s5.text(100,180,"Pid1").addClass("code");
s5.circle(135,240,40).addClass("shape grey");

s5.text(500,220,"Pid2").addClass("code");
s5.circle(535,280,40).addClass("shape darkred");

var s5_g1_1 = s5.text(15,340,"Pid2").addClass("code bold darkred");
var s5_g1_2 = s5.text(15,340,"     ! {self(),foo}").addClass("code");

var s5_g2_1 = s5.text(250,230,"{Pid1,foo}").addClass("code");
var s5_g2_2 = s5.path("M184,240 l300,35").attr({"marker-end":marker}).addClass("line");

s5.text(365,390,"receive").addClass("code");
s5.text(365,428,"  start -> ...").addClass("code");
s5.text(365,466,"  stop -> ...").addClass("code");
s5.text(365,504,"  {Pid, foo} ->").addClass("code");
s5.text(365,542,"    ...").addClass("code");
s5.text(365,580,"end").addClass("code");

// part of code in bold
var s5_g3_1 = s5.text(365,504,"  {Pid, foo} ->").addClass("code bold darkred");
var s5_g3_2 = s5.text(365,542,"    ...").addClass("code bold darkred");

var s5_g1 = s5.g(s5_g1_1, s5_g1_2);
var s5_g2 = s5.g(s5_g2_1, s5_g2_2);
var s5_g3 = s5.g(s5_g3_1, s5_g3_2);

s5_g1.addClass("hide");
s5_g2.addClass("hide");
s5_g3.addClass("hide");

s5_anim1 = function() { s5_g1.animate({"opacity":"1"}, 250, mina.linear, s5_anim2); }
s5_anim2 = function() { s5_g2.animate({"opacity":"1"}, 500, mina.linear); }

var s5_counter=1
s5.click( function() {
  switch(s5_counter) {
    case 1: {s5_anim1(); s5_counter++; break};
    case 2: {s5_g3.animate({"opacity":"1"}, 250, mina.linear); s5_counter++; break};
    }
} );

</script>
</svg>
<div class="ulist right"><ul><li><p>Messages can be matched and selectively retrieved</p></li><li><p>Messages are received when a message matches a clause</p></li><li><p>Mailboxes are scanned sequentially.</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Have the students execute a receive statement in the shell.</p></div></aside></section>
<section id="_receiving_messages_3"><h2>Receiving Messages</h2><svg id="receiving_messages_3" style="height:480px; width:1000px;">
<script>

var s6 = Snap("#receiving_messages_3");

var arrow = s6.polygon([0,0, 4,2, 0,4]).attr({"fill":"#000"}).transform('r0');
var marker = arrow.marker(0,0, 4,4, 3,2);

var s6_g1_1 = s6.text(115,40,"Pid2").addClass("code");
var s6_g1_2 = s6.text(115,40,"     !").addClass("code bold darkred");
var s6_g1_3 = s6.text(115,40,"       {self(), {digit, [1,2,3,4]}}").addClass("code");

s6.text(25,100,"Pid1").addClass("code");
s6.circle(60,160,40).addClass("shape grey");

s6.text(915,100,"Pid2").addClass("code");
s6.circle(950,160,40).addClass("shape darkred");

var s6_g2_1 = s6.text(270,145,"{Pid1, {digit, [1,2,3,4]}}").addClass("code");
var s6_g2_2 = s6.path("M110,160 l790,0").attr({"marker-end":marker}).addClass("line");

s6.text(580,250,"receive").addClass("code");
s6.text(580,288,"  {").addClass("code");
s6.text(580,288,"   Pid").addClass("code bold darkred");
s6.text(580,288,"      ,{digit,Digit}} ->").addClass("code");
s6.text(580,326,"    stop -> ...").addClass("code");
s6.text(580,364,"end").addClass("code");


var s6_g1 = s6.g(s6_g1_1, s6_g1_2, s6_g1_3);
var s6_g2 = s6.g(s6_g2_1, s6_g2_2);

s6_g1.addClass("hide");
s6_g2.addClass("hide");

s6_anim1 = function() { s6_g1.animate({"opacity":"1"}, 500, mina.linear, s6_anim2); }
s6_anim2 = function() { s6_g2.animate({"opacity":"1"}, 250, mina.linear); }
s6.click(function() { s6_anim1() });

</script>
</svg>
<div class="ulist"><ul><li><p>If <strong>Pid</strong> is bound before receiving the message, then only data tagged with that pid can be pattern matched</p></li><li><p>The variable <strong>Digit</strong> is bound when receiving the message</p></li></ul></div></section>
<section id="_receiving_messages_strong_selective_strong"><h2>Receiving Messages: <strong>selective</strong></h2><svg id="receiving_messages_selective" style="height:700px; width:600px;" class="left">
<script>

var s7 = Snap("#receiving_messages_selective");

var arrow = s7.polygon([0,0, 4,2, 0,4]).attr({"fill":"#000"}).transform('r0');
var marker = arrow.marker(0,0, 4,4, 3,2);

s7.text(60,50,"Pid1").addClass("code");
s7.circle(95,110,40).addClass("shape grey");
var s7_g3 = s7.text(20,200,"Pid3 ! foo").addClass("code");

s7.text(60,350,"Pid2").addClass("code");
s7.circle(95,410,40).addClass("shape grey");
var s7_g1 = s7.text(20,500,"Pid3 ! bar").addClass("code");

s7.text(430,200,"Pid3").addClass("code");
s7.circle(465,260,40).addClass("shape darkred");

var s7_g4_1 = s7.text(250,150,"foo").addClass("code");
var s7_g4_2 = s7.path("M145,120 l270,120").attr({"marker-end":marker}).addClass("line");

var s7_g2_1 = s7.text(240,315,"bar").addClass("code");
var s7_g2_2 = s7.path("M145,400 l270,-120").attr({"marker-end":marker}).addClass("line");

s7.text(310,410,"receive").addClass("code");
s7.text(310,448,"  foo").addClass("code bold darkred");
s7.text(310,448,"      -> true").addClass("code");
s7.text(310,486,"end,").addClass("code");
s7.text(310,524,"receive").addClass("code");
s7.text(310,562,"  bar").addClass("code bold darkred");
s7.text(310,562,"      -> true").addClass("code");
s7.text(310,600,"end,").addClass("code");
s7.text(310,638,"...").addClass("code");

var s7_g2 = s7.g(s7_g2_1, s7_g2_2);
var s7_g4 = s7.g(s7_g4_1, s7_g4_2);

s7_g1.addClass("hide");
s7_g2.addClass("hide");
s7_g3.addClass("hide");
s7_g4.addClass("hide");

s7_anim1 = function() { s7_g1.animate({"opacity":"1"}, 250, mina.linear, s7_anim2); }
s7_anim2 = function() { s7_g2.animate({"opacity":"1"}, 250, mina.linear); }

s7_anim3 = function() { s7_g3.animate({"opacity":"1"}, 250, mina.linear, s7_anim4); }
s7_anim4 = function() { s7_g4.animate({"opacity":"1"}, 250, mina.linear); }

var s7_counter=1
s7.click( function() {
  switch(s7_counter) {
    case 1: {s7_anim1(); s7_counter++; break};
    case 2: {s7_anim3(); s7_counter++; break};
    }
} );

</script>
</svg>
<div class="ulist right"><ul><li><p>The message <strong>foo</strong> is received, followed by the message <strong>bar</strong></p></li><li><p>This is irrespective of the order in which they were sent or stored in the mailbox</p></li></ul></div></section>
<section id="_receiving_messages_strong_non_selective_strong"><h2>Receiving Messages: <strong>non-selective</strong></h2><svg id="receiving_messages_non_selective" style="height:700px; width:600px;" class="left">
<script>

var s8 = Snap("#receiving_messages_non_selective");

var arrow = s8.polygon([0,0, 4,2, 0,4]).attr({"fill":"#000"}).transform('r0');
var marker = arrow.marker(0,0, 4,4, 3,2);

s8.text(60,50,"Pid1").addClass("code");
s8.circle(95,110,40).addClass("shape grey");
var s8_g3 = s8.text(20,200,"Pid3 ! foo").addClass("code");

s8.text(60,350,"Pid2").addClass("code");
s8.circle(95,410,40).addClass("shape grey");
var s8_g1 = s8.text(20,500,"Pid3 ! bar").addClass("code");

s8.text(430,200,"Pid3").addClass("code");
s8.circle(465,260,40).addClass("shape darkred");

var s8_g4_1 = s8.text(250,150,"foo").addClass("code");
var s8_g4_2 = s8.path("M145,120 l270,120").attr({"marker-end":marker}).addClass("line");

var s8_g2_1 = s8.text(240,315,"bar").addClass("code");
var s8_g2_2 = s8.path("M145,400 l270,-120").attr({"marker-end":marker}).addClass("line");

s8.text(310,410,"receive").addClass("code");
s8.text(310,448,"  Msg").addClass("code bold darkred");
s8.text(310,448,"      -> true").addClass("code");
s8.text(310,486,"end,").addClass("code");
s8.text(310,524,"...").addClass("code");

var s8_g2 = s8.g(s8_g2_1, s8_g2_2);
var s8_g4 = s8.g(s8_g4_1, s8_g4_2);

s8_g1.addClass("hide");
s8_g2.addClass("hide");
s8_g3.addClass("hide");
s8_g4.addClass("hide");

s8_anim1 = function() { s8_g1.animate({"opacity":"1"}, 250, mina.linear, s8_anim2); }
s8_anim2 = function() { s8_g2.animate({"opacity":"1"}, 250, mina.linear); }

s8_anim3 = function() { s8_g3.animate({"opacity":"1"}, 250, mina.linear, s8_anim4); }
s8_anim4 = function() { s8_g4.animate({"opacity":"1"}, 250, mina.linear); }

var s8_counter=1
s8.click( function() {
  switch(s8_counter) {
    case 1: {s8_anim1(); s8_counter++; break};
    case 2: {s8_anim3(); s8_counter++; break};
    }
} );

</script>
</svg>
<div class="ulist right"><ul><li><p>The first message to arrive at the process <strong>Pid3</strong> will be processed</p></li><li><p>The variable <strong>Msg</strong> in the process <strong>Pid3</strong> will be bound to one of the atoms <strong>foo</strong> or <strong>bar</strong> depending on which arrives first.</p></li></ul></div></section>
<section id="_receiving_messages_4"><h2>Receiving Messages</h2><svg id="receiving_messages_6" style="height:500px; width:1100px;">
<script>

var s9 = Snap("#receiving_messages_6");

var arrow = s9.polygon([0,0, 4,2, 0,4]).attr({"fill":"#000"}).transform('r0');
var marker = arrow.marker(0,0, 4,4, 3,2);

s9.circle(120,130,40).addClass("shape darkred");
s9.text(85,70,"PidA").addClass("code");

var s9_g1 = s9.text(20,250,"PidB ! {transfer,self()}").addClass("code");
var s9_g2 = s9.path("M170,150 l320,70").attr({"marker-end":marker}).addClass("line");

s9.circle(540,230,40).addClass("shape darkred");
s9.text(505,170,"PidB").addClass("code");

var s9_g3 = s9.path("M590,220 l320,-70").attr({"marker-end":marker}).addClass("line");

s9.circle(960,130,40).addClass("shape darkred");
s9.text(925,70,"PidC").addClass("code");

var s9_g4_1 = s9.path("M 909,110 C 663,30 417,30 171,110").attr({"marker-end":marker}).addClass("line");
var s9_g4_2 = s9.text(515,30,"foo").addClass("code");

s9.text(750,230,"receive").addClass("code");
s9.text(750,268,"  {transfer, Pid} ->").addClass("code");
s9.text(750,306,"    Pid ! foo").addClass("code");
s9.text(750,344,"end").addClass("code");

s9.text(240,320,"receive").addClass("code");
s9.text(240,358,"  {transfer, Pid} ->").addClass("code");
s9.text(240,396,"    PidC ! {transfer, Pid}").addClass("code");
s9.text(240,434,"end").addClass("code");

var s9_g4 = s9.g(s9_g4_1, s9_g4_2);

s9_g1.addClass("hide");
s9_g2.addClass("hide");
s9_g3.addClass("hide");
s9_g4.addClass("hide");

s9_anim1 = function() { s9_g1.animate({"opacity":"1"}, 250, mina.linear, s9_anim2); }
s9_anim2 = function() { s9_g2.animate({"opacity":"1"}, 250, mina.linear); }

var s9_counter=1
s9.click( function() {
  switch(s9_counter) {
    case 1: {s9_anim1(); s9_counter++; break};
    case 2: {s9_g3.animate({"opacity":"1"}, 250, mina.linear); s9_counter++; break};
    case 3: {s9_g4.animate({"opacity":"1"}, 250, mina.linear); s9_counter++; break};
    }
} );

</script>
</svg>
<div class="ulist"><ul><li><p>PidA sends a message to PidB containing its own Pid</p></li><li><p>PidB binds it to variable Pid and sends a message to PidC</p></li><li><p>PidC receives the message and replies directly to PidA</p></li></ul></div></section>
<section id="_data_in_messages_strong_example_strong"><h2>Data in Messages: <strong>example</strong></h2><div class="literalblock left"><div class="content"><pre>-module(echo).
-export([go/0, loop/0]).

go() -&gt;
  Pid= spawn(echo,loop,[]),
  Pid ! {self(), hello},
  receive
    {Pid, Msg} -&gt;
      io:format("~w~n",[Msg])
  end,
  Pid ! stop.</pre></div></div>
<div class="literalblock right"><div class="content"><pre> 
loop() -&gt;
  receive
    {From, Msg} -&gt;
      From ! {self(), Msg},
      loop();
    stop -&gt;
      true
  end.
 
 </pre></div></div>
<aside class="notes"><div class="paragraph"><p>Use a white board &amp; pen and paper to explain this example.
Show the message sequence diagram.
Stress tail recursion and process terminates when no more code to execute after ‘stop’ message has been received. ‘stop’ message no special significance.</p></div></aside></section>
<section id="_summary_strong_concurrent_erlang_i_strong"><h2>Summary: <strong>concurrent Erlang I</strong></h2><div class="ulist"><ul><li><p>Concurrent Erlang I</p><div class="ulist"><ul><li><p>Creating Processes</p></li><li><p>Message Passing</p></li><li><p>Receiving Messages</p></li><li><p>Data in Messages</p></li></ul></div></li><li><p>Concurrent Erlang II</p></li></ul></div></section>
<section id="_overview_strong_concurrent_erlang_ii_strong"><h2>Overview: <strong>concurrent Erlang II</strong></h2><div class="ulist"><ul><li><p>Concurrent Erlang I</p></li><li><p>Concurrent Erlang II</p><div class="ulist"><ul><li><p>Registered Processes</p></li><li><p>Timeouts</p></li><li><p>More on Processes</p></li><li><p>The Process Manager</p></li></ul></div></li></ul></div></section>
<section id="_registered_processes"><h2>Registered Processes</h2><div class="literalblock centered bold darkred"><div class="content"><pre>register(Alias, Pid)
Alias ! Message</pre></div></div>
<div class="ulist"><ul><li><p>Registers the process <strong>Pid</strong> with the name <strong>Alias</strong>, which has to be an atom</p></li><li><p>Any process can send a message to a registered process</p></li><li><p>The BIF <strong>registered/0</strong> returns all registered process names</p></li><li><p>The BIF <strong>whereis(Alias)</strong> returns the Pid of the process with the name <strong>Alias</strong>.</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Have the students try out these BIFs in the shell: register(self(), shell).
Ask them what the other registered() processes are (As the ERTS / Kernel is in large part written in Erlang).
Let them find the registered shell process using regs() and i().</p></div></aside></section>
<section id="_registered_processes_2"><h2>Registered Processes</h2><svg id="registered_processes_2" style="height:250px; width:860px;" class="left">
<script>

var s10 = Snap("#registered_processes_2");

var arrow = s10.polygon([0,0, 4,2, 0,4]).attr({"fill":"#000"}).transform('r0');
var marker = arrow.marker(0,0, 4,4, 3,2);

s10.circle(300,130,40).addClass("shape grey");
s10.text(265,70,"Pid1").addClass("code");

var s10_g1_1 = s10.text(425,115,"{Pid1,hello}").addClass("code");
var s10_g1_2 = s10.path("M350,130 l375,0").attr({"marker-end":marker}).addClass("line");

s10.circle(780,130,40).addClass("shape darkred");
s10.text(745,70,"echo").addClass("code");

s10.text(72,220,"echo ! {self(), hello}").addClass("code");

var s10_g1 = s10.g(s10_g1_1, s10_g1_2).addClass("hide");

s10.click(function() { s10_g1.animate({"opacity":"1"}, 250, mina.linear) });

</script>
</svg>
<div class="literalblock left"><div class="content"><pre>-module(echo).
-export([go/0, loop/0]).

go() -&gt;
  Pid = spawn(echo,loop,[]),
  register(echo, Pid).
 
 
 </pre></div></div>
<div class="literalblock right"><div class="content"><pre>loop() -&gt;
  receive
    {From, Msg} -&gt;
      From ! {self(), Msg},
      loop();
    stop -&gt;
      true
  end.
 </pre></div></div></section>
<section id="_message_passing_3"><h2>Message Passing</h2><svg id="message_passing_3" style="height:400px; width:600px;" class="left">
<script>

var s11 = Snap("#message_passing_3");

var arrow = s11.polygon([0,0, 5,2.5, 0,5]).attr({"fill":"#000"}).transform('r0');
var marker = arrow.marker(0,0, 5,5, 4,2.75);

s11.polyline([160,200,196.3543676,225.3559301,152.0626766,227.0320409,168.9374661,268.0174617,130.7707507,245.4815998,122.8083354,289.0839298,102.8842581,249.4910721,72.61264883,281.8668796,77.2569633,237.7874787,34.28718205,248.6576736,62.02535132,214.0866278,20,200,62.02535132,185.9133722,34.28718205,151.3423264,77.2569633,162.2125213,72.61264883,118.1331204,102.8842581,150.5089279,122.8083354,110.9160702,130.7707507,154.5184002,168.9374661,131.9825383,152.0626766,172.9679591,196.3543676,174.6440699]).addClass("darkred shape");

s11.text(75,90,"Pid1").addClass("code");
s11.circle(110,200,40).addClass("shape grey");

s11.text(20,335,"does_not_exist").addClass("code darkred bold");
s11.text(20,335,"               ! hello").addClass("code");

var s11_g1_2 = s11.path("M200,200 l250,0").attr({"marker-end":marker}).addClass("line");

s11.text(480,250,"?").addClass("darkred").attr({"font-size":"150"});

</script>
</svg>
<div class="ulist right"><ul><li><p>Sending messages to non-existing registered processes causes the calling process to terminate with a <strong>badarg</strong> error</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Try this in the shell.
Let them try it with catch foo ! bang.</p></div></aside></section>
<section id="_timeouts"><h2>Timeouts</h2><svg id="timeouts_1" style="height:600px; width:600px;" class="left">
<script>

var s12 = Snap("#timeouts_1");

var arrow = s12.polygon([0,0, 4,2, 0,4]).attr({"fill":"#000"}).transform('r0');
var marker = arrow.marker(0,0, 4,4, 3,2);

var clock = s12.polygon([0,0, 3,1.5, 0,3]).attr({"fill":"#000"}).transform('r0');
var hand = clock.marker(0,0, 3,3, 2,1.5);

// clock face
s12.circle(100,100,48).attr({"fill":"none", "stroke":"#888", "stroke-width":"2"});

// clock hands
s12.path("M100,100 l0,-40").attr({"stroke":"#000", "stroke-width":"2", "marker-end":hand});
s12.path("M100,100 l24,-18").attr({"stroke":"#000", "stroke-width":"2", "marker-end":hand});

s12.text(65,275,"PidA").addClass("code");
s12.circle(100,330,40).addClass("shape grey");

s12.text(435,95,"PidB").addClass("code");
s12.circle(470,150,40).addClass("shape darkred");

var s12_g1_2 = s12.path("M158,100 l260,40").attr({"marker-end":marker}).addClass("line");
var s12_g1_2 = s12.path("M150,315 l270,-150").attr({"marker-end":marker}).addClass("line");

s12.text(220,95,"timeout").addClass("code");
s12.text(235,220,"Msg").addClass("code");

s12.text(250,350,"receive").addClass("code bold");
s12.text(250,388,"  Msg ->").addClass("code");
s12.text(250,426,"    &lt;expressions1&gt;").addClass("code");
s12.text(250,464,"  after").addClass("code bold");
s12.text(250,464,"  after TimeOut ->").addClass("code");
s12.text(250,502,"    &lt;expressions2&gt;").addClass("code");
s12.text(250,540,"end").addClass("code bold");

</script>
</svg>
<div class="ulist right"><ul><li><p>If the message <strong>Msg</strong> is received within the time <strong>TimeOut</strong>, &lt;expressions1&gt; will be executed</p></li><li><p>If not, &lt;expressions2&gt; will be executed</p></li><li><p>TimeOut is an integer denoting the time in milliseconds or the atom <strong>infinity</strong></p></li></ul></div></section>
<section id="_timeouts_2"><h2>Timeouts</h2><div class="left" style="width: 600px;">
<div class="pre">read(Key) ->
    db ! {self(), {read, Key}},
    <span class="redcode">receive</span>
      {read, R} ->
         {ok, R};
      {error, Reason} ->
         {error, Reason}
    <span class="redcode">after</span> 1000 ->
      {error, timeout}
    <span class="redcode">end</span>.
 
 
 
</div></div>
<div class="ulist right"><ul><li><p>If the server takes more than a second to handle the request, a timeout is generated</p></li><li><p>Do not forget to handle messages received after a timeout</p></li></ul></div></section>
<section id="_timeouts_3"><h2>Timeouts</h2><div class="left" style="width: 600px;">
<div class="pre">send_after(Time, Msg) ->
    spawn(timer,
          send,
          [self(),Time,Msg]).

send(Pid, Time, Msg) ->
    <span class="redcode">receive </span>
    <span class="redcode">after</span> Time ->
        Pid ! Msg 
    <span class="redcode">end</span>.

sleep(T) ->
    <span class="redcode">receive</span>
    <span class="redcode">after</span> T ->
        true
    <span class="redcode">end</span>.
</div></div>
<div class="ulist right"><ul><li><p><strong>send_after(T, What)</strong> sends the message <strong>What</strong> to the current process after <strong>T</strong> milliseconds</p></li><li><p>The <strong>sleep(T)</strong> function will suspend the calling process for <strong>T</strong> milliseconds</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Explain that receive with no messages will never match any message</p></div></aside></section>
<section id="_timeouts_4"><h2>Timeouts</h2><svg id="timeouts_2" style="height:640px; width:640px;" class="left">
<style type="text/css">
    .msgtext {fill:#fff; font-size:16pt;}
    .msgrect {fill:#888;}
</style>
<script>

var s13 = Snap("#timeouts_2");

s13.rect(10,10,600,560).attr({"stroke":"#E1E1E1", "stroke-width":"2", "fill":"#F2F2F2"});

s13.text(20,50,"flush() ->").addClass("code");
s13.text(20,88,"  receive do").addClass("code darkred bold");
s13.text(20,126,"    _ -> flush()").addClass("code");
s13.text(20,164,"  after").addClass("code darkred bold");
s13.text(20,164,"        0 ->").addClass("code");
s13.text(20,202,"    ok").addClass("code");
s13.text(20,240,"  end").addClass("code darkred bold");
s13.text(20,240,"     .").addClass("code");

s13.circle(490,300,40).addClass("shape darkred");

var msg1_rect = s13.rect(400,350,180,40,15,15).addClass("shape msgrect");
var msg1_text = s13.text(435,378,"Message 1").addClass("msgtext");

var msg2_rect = msg1_rect.clone().transform( "t0,50" );
var msg2_text = s13.text(435,428,"Message 2").addClass("msgtext");

var msg3_rect = msg1_rect.clone().transform( "t0,100" );
var msg3_text = s13.text(435,478,"Message 3").addClass("msgtext");

var msg4_rect = msg1_rect.clone().transform( "t0,150" );
var msg4_text = s13.text(435,528,"Message 4").addClass("msgtext");

var msg1 = s13.g(msg1_rect, msg1_text);
var msg2 = s13.g(msg2_rect, msg2_text);
var msg3 = s13.g(msg3_rect, msg3_text);
var msg4 = s13.g(msg4_rect, msg4_text);

var msgs = s13.g(msg1, msg2, msg3, msg4)

s13_anim1 = function() { msg1.animate({"opacity":"0"}, 400, mina.linear, s13_anim2); };
s13_anim2 = function() { msgs.animate({"transform":"t0,-50"}, 250, mina.linear, s13_anim3); };
s13_anim3 = function() { msg2.animate({"opacity":"0"}, 400, mina.linear, s13_anim4); };
s13_anim4 = function() { msgs.animate({"transform":"t0,-100"}, 250, mina.linear, s13_anim5); };
s13_anim5 = function() { msg3.animate({"opacity":"0"}, 400, mina.linear, s13_anim6); };
s13_anim6 = function() { msgs.animate({"transform":"t0,-150"}, 250, mina.linear, s13_anim7); };
s13_anim7 = function() { msg4.animate({"opacity":"0"}, 400, mina.linear); };

s13.click(function() { s13_anim1() });

</script>
</svg>
<div class="ulist right"><ul><li><p><strong>flush()</strong> will clear the mailbox from all messages, stopping when it is empty.</p></li></ul></div></section>
<section id="_more_on_processes_strong_definitions_strong"><h2>More on Processes: <strong>definitions</strong></h2><div class="dlist"><dl><dt class="hdlist1"><strong>Process</strong></dt><dd><p>A concurrent activity. The system may have many concurrent processes executing at the same time</p></dd><dt class="hdlist1"><strong>Message</strong></dt><dd><p>A method of communication and sharing data between processes</p></dd><dt class="hdlist1"><strong>Timeout</strong></dt><dd><p>A mechanism for waiting for a given period of time for an incoming message</p></dd></dl></div></section>
<section id="_more_on_processes_strong_definitions_strong_2"><h2>More on Processes: <strong>definitions</strong></h2><div class="dlist"><dl><dt class="hdlist1"><strong>Registered Processes</strong></dt><dd><p>Processes which have been given a name with BIFs such as <strong>register/2</strong>.</p></dd><dt class="hdlist1"><strong>Termination</strong></dt><dd><p>A process is said to terminate normally when it has no more code to execute.</p></dd><dt class="hdlist1"></dt><dd><p>It terminates abnormally if a run time error occurs or if someone makes it exit with a non-normal reason.</p></dd></dl></div></section>
<section id="_more_on_processes_strong_process_skeleton_strong"><h2>More on Processes: <strong>process skeleton</strong></h2><svg id="process_skeleton" style="height:600px; width:1020px;" class="left">
<style type="text/css">
    .text {fill:#fff; font-size:20pt;}
    .grey {fill:#959595;}
    .code {font-size: 20pt;}
</style>
<script>

var s14 = Snap("#process_skeleton");

var arrow = s14.polygon([0,0, 4,2, 0,4]).attr({"fill":"#000"}).transform('r0').addClass("darkred");
var marker = arrow.marker(0,0, 4,4, 3,2);

s14.ellipse(900,50,80,35).addClass("shape darkred");
s14.text(870,60,"Start").addClass("text");

s14.rect(820,140,160,80).addClass("shape grey");
s14.text(845,190,"Initialise").addClass("text");

s14.ellipse(650,280,80,35).addClass("shape darkred");
s14.text(625,290,"Stop").addClass("text");

s14.rect(850,265,100,100,20,20).addClass("shape").attr({"fill":"#E1E1E1"});
s14.text(870,325,"loop");

s14.rect(820,410,160,80).addClass("shape grey");
s14.text(838,460,"terminate").addClass("text");

s14.path("M900,85 l0,57").attr({"marker-end":marker}).addClass("line_darkred");
s14.path("M900,220 l0,47").attr({"marker-end":marker}).addClass("line_darkred");
s14.path("M950,300 C1020,250 1020,380 953,330").attr({"marker-end":marker}).addClass("line_darkred");
s14.path("M730,280 l120,35").attr({"marker-end":marker}).addClass("line_darkred");
s14.path("M900,365 l0,47").attr({"marker-end":marker}).addClass("line_darkred");

s14.text(10,40,"start(Args) -> spawn(server, init, [Args])").addClass("code");
s14.text(10,78,"").addClass("code");
s14.text(10,116,"init(Args) ->").addClass("code");
s14.text(10,154,"  State = initialize_state(Args),").addClass("code");
s14.text(10,192,"  loop(State).").addClass("code");
s14.text(10,230,"").addClass("code");
s14.text(10,268,"loop(State) ->").addClass("code");
s14.text(10,306,"   receive").addClass("code");
s14.text(10,344,"      {handle, Msg} -> ").addClass("code");
s14.text(10,382,"         NewState = handle(Msg, State),").addClass("code");
s14.text(10,420,"         loop(NewState);").addClass("code");
s14.text(10,458,"      stop -> terminate(State)").addClass("code");
s14.text(10,496,"   end.").addClass("code");
s14.text(10,534,"").addClass("code");
s14.text(10,572,"terminate(State) -> clean_up(State).").addClass("code");

</script>
</svg>
<aside class="notes"><div class="paragraph"><p>Explain how processes, while doing very different things, do so following a particular pattern.
Give two examples on how the above code could be used for different functionality, e.g. a Window handler and a database.</p></div></aside></section>
<section id="_the_process_manager"><h2>The Process Manager</h2><div class="ulist"><ul><li><p>Used to inspect the state of processes in a local or distributed Erlang system</p></li><li><p>Trace output for messages sent &amp; received</p></li><li><p>Trace output for process events such as spawn, exit and link</p></li><li><p>Trace output for BIF and function calls</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>If you are running low on time, jump over this section. Else, let them try it in the shell.</p></div></aside></section>
<section id="_the_process_manager_2"><h2>The Process Manager</h2><svg id="process_manager_1" style="height:500px; width:1020px;" class="left">
<style type="text/css">
    .text {fill:#fff; font-size:20pt;}
</style>
<script>

var s15 = Snap("#process_manager_1");

s15.image("images/process_manager_1.png", 150, 60, 803, 375);

var s15_g1_1 = s15.polyline([165,100, 255,100, 320,165, 320,255, 255,320, 165,320, 100,255, 100,165, 165,100]).attr({"fill":"darkred"}).addClass("shape");
var s15_g1_2 = s15.text(125,180,"The Windows").addClass("text");
var s15_g1_3 = s15.text(145,210,"version is").addClass("text");
var s15_g1_4 = s15.text(128,240,"known to be").addClass("text");
var s15_g1_5 = s15.text(152,270,"unstable").addClass("text");

var s15_g1 = s15.g(s15_g1_1, s15_g1_2, s15_g1_3, s15_g1_4, s15_g1_5);

s15_g1.transform( "t-80,-60" )

</script>
</svg>
<div class="ulist"><ul><li><p>pman:start()</p></li></ul></div>
<aside class="notes"><div class="paragraph"><p>Have the students try this out.</p></div></aside></section>
<section id="_process_manager_strong_processes_strong"><h2>Process Manager: <strong>processes</strong></h2><div style="width:100%; text-align:center;">
<img src="images/process_manager_2.png" style="width:520px; height:auto;" />
</div>
<div class="ulist"><ul><li><p>Prints the trace messages and process state</p></li></ul></div></section>
<section id="_process_manager_strong_options_strong"><h2>Process Manager: <strong>options</strong></h2><div style="width:100%; text-align:center;">
<img src="images/process_manager_3.png" style="height:400px; width:auto;" />
</div>
<div class="ulist"><ul><li><p>Pick what trace messages you want to view</p></li><li><p>Pick the inheritance level when spawning</p></li></ul></div></section>
<section id="_summary_strong_concurrent_erlang_strong"><h2>Summary: <strong>concurrent Erlang</strong></h2><div class="ulist"><ul><li><p>Concurrent Erlang I</p><div class="ulist"><ul><li><p>Creating Processes</p></li><li><p>Message Passing</p></li><li><p>Receiving Messages</p></li><li><p>Data in Messages</p></li></ul></div></li><li><p>Concurrent Erlang II</p><div class="ulist"><ul><li><p>Registered Processes</p></li><li><p>Timeouts</p></li><li><p>More on Processes</p></li><li><p>The Process Manager</p></li></ul></div></li></ul></div></section></div></div><script src="reveal.js/lib/js/head.min.js"></script><script src="reveal.js/js/reveal.min.js"></script><script type="text/javascript">// See https://github.com/hakimel/reveal.js#configuration for a full list of configuration options
Reveal.initialize({
  // Display controls in the bottom right corner
  controls: true,
  // Display a presentation progress bar
  progress: true,
  // Display the page number of the current slide
  slideNumber: true,
  // Push each slide change to the browser history
  history: true,
  // Enable keyboard shortcuts for navigation
  keyboard: true,
  // Enable the slide overview mode
  overview: true,
  // Vertical centering of slides
  center: false,
  // Enables touch navigation on devices with touch input
  touch: true,
  // Loop the presentation
  loop: false,
  // Change the presentation direction to be RTL
  rtl: false,
  // Turns fragments on and off globally
  fragments: true,
  // Flags if the presentation is running in an embedded mode,
  // i.e. contained within a limited portion of the screen
  embedded: false,
  // Number of milliseconds between automatically proceeding to the
  // next slide, disabled when set to 0, this value can be overwritten
  // by using a data-autoslide attribute on your slides
  autoSlide: 0,
  // Stop auto-sliding after user input
  autoSlideStoppable: true,
  // Enable slide navigation via mouse wheel
  mouseWheel: false,
  // Hides the address bar on mobile devices
  hideAddressBar: true,
  // Opens links in an iframe preview overlay
  previewLinks: false,
  // Theme (e.g., beige, blond, default, moon, night, serif, simple, sky, solarized)
  theme: Reveal.getQueryHash().theme || 'esl',
  // Transition style (e.g., default, cube, page, concave, zoom, linear, fade, none)
  transition: Reveal.getQueryHash().transition || 'linear',
  // Transition speed (e.g., default, fast, slow)
  transitionSpeed: 'default',
  // Transition style for full page slide backgrounds (e.g., default, none, slide, concave, convex, zoom)
  backgroundTransition: 'default',
  // Number of slides away from the current that are visible
  viewDistance: 3,
  // Parallax background image (e.g., "'https://s3.amazonaws.com/hakim-static/reveal-js/reveal-parallax-1.jpg'")
  parallaxBackgroundImage: '',
  // Parallax background size in CSS syntax (e.g., "2100px 900px")
  parallaxBackgroundSize: '',
  // Optional libraries used to extend on reveal.js
  dependencies: [
      { src: 'reveal.js/lib/js/classList.js', condition: function() { return !document.body.classList; } },
      { src: 'reveal.js/plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      { src: 'reveal.js/plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
      
      { src: 'reveal.js/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
      { src: 'reveal.js/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
  ]
});</script></body></html>